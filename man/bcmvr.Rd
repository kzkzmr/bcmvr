% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/bcmvr.R
\name{bcmvr}
\alias{bcmvr}
\title{Treatment effect inference using a Box--Cox multivariate regression (BCMVR)
model for longitudinal data in randomized controlled trials}
\usage{
bcmvr(
  data,
  outcome,
  id,
  group,
  time,
  cov = NULL,
  pairs,
  smaller,
  t_eval = NULL,
  robust = TRUE,
  level = 0.95
)
}
\arguments{
\item{data}{A data frame in long format.}

\item{outcome}{Name of the outcome variable (must be positive).}

\item{id}{Name of the subject identifier.}

\item{group}{Name of the group variable.}

\item{time}{Name of the time variable.}

\item{cov}{Optional character vector of baseline covariate names
(time-invariant within subject). Covariates that are constant within any
group are dropped from the analysis with a warning, to ensure comparability
of covariate-adjusted effects across groups.}

\item{pairs}{A list of length-2 vectors specifying ordered group pairs
\code{c(g1, g2)} for comparison, where \code{g1} is the test group and
\code{g2} is the control group. The order matters. Each element must be
either group labels (as they appear in \code{group}) or their positions in
the sorted unique group labels.}

\item{smaller}{Logical. Must be specified. \code{TRUE} if a smaller outcome
value is clinically favorable, \code{FALSE} otherwise. This argument
determines the direction of the probability-based effect measure.}

\item{t_eval}{Optional integer vector specifying time points at which
effects are evaluated. If \code{NULL}, all time points are used.}

\item{robust}{Logical. If \code{TRUE} (default), robust sandwich variance
estimators are used for inference. If \code{FALSE}, model-based variance
estimators are used.}

\item{level}{Confidence level for Wald-type confidence intervals.}
}
\value{
A list with the following components:
\describe{
  \item{call}{The matched function call.}
  \item{datalist}{A list returned by the internal data reshaping routine,
    including group-wise outcome matrices and covariate matrices.}
  \item{glst}{Sorted unique group labels used in the analysis.}
  \item{tt}{Number of time points (columns of the wide outcome matrix).}
  \item{t_eval}{Time points at which effects are evaluated.}
  \item{xmean}{Pooled covariate means across all subjects (or \code{NULL} if
    \code{cov = NULL}).}
  \item{pairs}{A data frame of ordered group pairs actually used for
    comparisons.}
  \item{fit}{A list of fitted group-specific BCMVR model objects.}
  \item{vcov}{A list of variance--covariance estimates (model-based and
    robust) for each group.}
  \item{median}{A data frame of group-specific marginal medians with
    standard errors and Wald-type confidence intervals.}
  \item{meddiff}{A data frame of median differences for specified ordered
    pairs, computed as \code{median(g1) - median(g2)}, with standard errors,
    confidence intervals, and Wald-type p-values under independent groups.}
  \item{prob}{A data frame of probability-based effect measures. It reports
    \eqn{P(Y_{g1,t} < Y_{g2,t})} on the original outcome scale, with
    inference performed on the logit scale. Under \code{smaller = TRUE},
    this can be interpreted as the probability that the test group
    (\code{g1}) has a more favorable outcome than the control group
    (\code{g2}).}
}
}
\description{
Fit Box--Cox multivariate regression models separately for each group and
perform prespecified group comparisons based on (i) median differences and
(ii) probability-based treatment effect measures.
}
\details{
This function is the main user-facing interface of the \pkg{bcmvr} package.
Internally, it fits group-specific BCMVR models, estimates variance--
covariance matrices, and computes inferential summaries for:
\itemize{
  \item group-specific marginal medians (with Wald-type confidence
    intervals),
  \item median differences between prespecified group pairs (with CI and
    p-values),
  \item probability-based treatment effect measures comparing full
    marginal distributions.
}
}
\examples{
data(aidscd4, package = "bcmixed")
set.seed(1)

# sample ~140 subjects (IDs), keep all rows for those IDs
id_keep <- sample(unique(aidscd4$id), size = 140, replace = FALSE)
dat <- subset(aidscd4, id \%in\% id_keep)

# (optional) make treatment a factor so pairs are readable/stable
dat$treatment <- factor(dat$treatment)

# define ordered pairs: g1=test, g2=control (here: compare 2/3/4 vs 1)
pairs <- list(
  c("2", "1"),
  c("3", "1"),
  c("4", "1")
  )

# CD4 is typically "larger is better" -> smaller = FALSE
res <- bcmvr(
  dat,
  outcome = cd4,
  id      = id,
  group   = treatment,
  time    = weekc,
  cov     = c("age", "cd4.bl"),
  pairs   = pairs,
  smaller = FALSE
  )

res$median
res$meddiff
res$prob

}
\references{
Maruo K et al. Inference on treatment effects for longitudinal outcomes with
skewed distributions. Submitting (available from author).
}
